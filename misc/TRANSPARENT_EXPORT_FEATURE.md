# 透明背景物体图像导出功能

## 功能概述

本功能在原有的2D合成图像生成基础上，新增了导出无背景的透明物体图像的能力。在合成"物体+背景"图像之前，系统会先将物体图像导出为带有透明背景的PNG文件。

## 功能特性

- **透明背景**: 使用RGBA格式，其中Alpha通道基于深度掩码生成
- **自动掩码**: 基于深度信息自动生成物体掩码，无需手动分割
- **可选功能**: 通过配置参数控制是否启用此功能
- **批量处理**: 支持多个视角和多个模型的批量透明背景导出
- **智能命名**: 输出文件使用统一的命名规则，便于识别

## 配置方法

### 1. 在 generate_3D.sh 中配置

编辑 `generate_3D.sh` 文件，设置以下参数：

```bash
EXPORT_TRANSPARENT=true    # 启用透明背景导出
# 或
EXPORT_TRANSPARENT=false   # 禁用透明背景导出
```

### 2. 通过环境变量配置

```bash
export EXPORT_TRANSPARENT=true
bash generate_3D.sh
```

### 3. 直接使用Python脚本

```bash
python generate_result_3D.py \
    --model_path "checkpoints/eshmun02" \
    --out_path "result/test_run" \
    --obj_models "obj4gen/01_level0.obj" \
    --export_transparent \
    --n 1
```

## 输出文件

启用透明背景导出功能后，系统会在每个样本目录中生成以下文件：

### 原有文件
- `{view_name}_{model_name}.png`: 合成图像（物体+背景）
- `{view_name}_{model_name}_mask.png`: 深度掩码图像
- `fake_views_{model_name}.png`: fake views可视化

### 新增文件
- `{view_name}_{model_name}_object_transparent.png`: **透明背景的物体图像**

## 文件格式说明

### 透明背景物体图像
- **格式**: PNG (RGBA)
- **分辨率**: 与原始渲染图像相同
- **通道说明**:
  - R, G, B: 物体的颜色信息
  - A (Alpha): 透明度通道
    - 255: 物体区域（不透明）
    - 0: 背景区域（完全透明）

## 技术实现

1. **深度掩码生成**: 基于渲染的深度图，将深度值大于0的区域标记为物体
2. **RGBA图像创建**: 
   - RGB通道：使用原始渲染的物体颜色
   - Alpha通道：使用深度掩码作为透明度信息
3. **文件保存**: 使用OpenCV保存为PNG格式，保持透明度信息

## 使用场景

- **图像合成**: 将生成的物体与其他背景进行合成
- **数据增强**: 为机器学习模型提供带透明背景的训练数据
- **视觉效果**: 用于游戏、动画或其他视觉应用
- **图像编辑**: 便于在图像编辑软件中进行后期处理

## 性能影响

- **存储空间**: 每个视角额外增加一个RGBA PNG文件
- **处理时间**: 增加的处理时间很少，主要是图像格式转换和文件保存
- **内存使用**: 临时增加少量内存用于RGBA图像创建

## 注意事项

1. **文件大小**: RGBA PNG文件通常比RGB文件稍大
2. **兼容性**: 确保使用的图像查看器或编辑软件支持PNG透明度
3. **质量**: 透明度基于深度掩码，边缘可能存在锯齿，可根据需要进行后处理
4. **存储空间**: 启用此功能会增加输出文件的总大小

## 故障排除

### 透明背景不正确
- 检查深度图是否正确生成
- 确认物体在场景中的位置是否合适

### 文件未生成
- 确认 `EXPORT_TRANSPARENT=true` 已正确设置
- 检查输出目录的写入权限
- 查看控制台输出中的错误信息

### 透明度效果不明显
- 使用支持透明度的图像查看器（如GIMP、Photoshop等）
- 在有色背景上查看透明效果